<% include ../../shared/header %>
<% include ../../shared/nav %>
<input type="hidden" name="_csrf" value=<%= locals.token %> >
<form name="items-form" class="_pea-form" method="get" >
	<div class="_pea-container">
		<div class="_pea-row _pea-form">
			<div class="_pea-col-span6">
				<a href="/p-admin/item/new" class="_pea-button _pea-color-info">New Item</a>
			</div>
			<div class="_pea-col-span6 _pea-text-right">
					<input type="text" placeholder="search" class="_pea-col-span10" name="search"/>
					<button type="submit" class="_pea-col-span2" >search</button>
			</div>
		</div>
		<div class="_pea-row">
			<div class="_pea-col-span12">
				<div class="_pea-document">
					<table class="_pea-table">
						<thead style="">
							<tr>
								<th colspan="4" class="_pea-text-left ">
									Page
									<a href="">&laquo;</a> 
									<input type="text" name="pagenum" class="_pea-text-center" style="width:2em;" value="<%- request.query.pagenum %>"/> of <%- itempages %> 
									<a href="">&raquo;</a>
								</th>
								<th colspan="3" class="_pea-text-right ">
									<span ><input type="text" name="itemsperpage" class="_pea-text-center"  style="width:2em;" value="<%- request.query.limit %>"/> per page</span> | 
									<span><%- itemscount %> items</span>
								</th>
							</tr>
						</thead>
						<thead>
							<tr class="_pea-text-left">
								<th>Title</th>
								<th>Author</th>
								<th>Categories</th>
								<th>Tags</th>
								<th>Type</th>
								<th>Date</th>
								<th></th>
							</tr>
						</thead>
						<tbody>
							<% if(items.length>0){
									items.forEach(function(item){ %>
										<tr>
											<td> 
												<% if(item.primaryasset && item.primaryasset.fileurl  && item.primaryasset.assettype.match("image")){%>
													<div class="_pea-pull-right _pea-col-span9" style="height:100%;">
														<a href="/p-admin/item/edit/<%= item.name %>" style="position:relative; vertical-align:center;"> <%= item.title %> </a>
													</div>
													<div class="_pea-pull-left _pea-col-span3" style=" overflow:hidden; max-height:5em; padding-right:1em;">
													
														<img src="<%- item.primaryasset.fileurl %>" style="width:100%; height:auto;" />
													</div>
												<%} 
												else{%>

												<div class="_pea-col-span12">
													<a href="/p-admin/item/edit/<%= item.name %>"> <%= item.title %> </a>
												</div>
												<%}%>

											</td>
											<td>
													<%if(item.primaryauthor){%>
														<%= item.primaryauthor.username %>
													<%}%>
											</td>
											<td>
												<%if(item.categories && item.categories.length>0){
													item.categories.forEach(function(category){%>
														<a href="/p-admin/items?filter_categories=<%= category.name %>"><%= category.title %></a>,
													<%});
												}%>
											</td>
											<td>
												<%if(item.tags && item.tags.length>0){
													item.tags.forEach(function(tag){%>
														<a href="/p-admin/items?filter_tags=<%= tag.name %>"><%= tag.title %></a>,
													<%});
												}%>
											</td>
											<td>
												<%if(item.contenttypes && item.contenttypes.length>0){
													item.contenttypes.forEach(function(contenttype){%>
														<a href="/p-admin/items?filter_contenttypes=<%= contenttype.name %>"><%= contenttype.title %></a>,
													<%});
												}%>
											</td>
											<td>
												<% var disDate = new Date(item.createdat) %>
												<%= (disDate.getFullYear()) %>/
												<%= (disDate.getMonth()+1) %>/
												<%= (disDate.getDate()) %>
											</td>
											<td>
												<a href="/p-admin/item/edit/<%= item.name %>" class="_pea-button _pea-color-inverse"> edit </a>
												<a href="/item/<%= item.name %>" class="_pea-button " target="_blank"> preview </a>
												<a data-href="/item/<%= item.name %>/delete" class="_pea-button _pea-color-error _pea-dialog-delete" data-successfunction="backToItemLanding" >delete</a>

											</td>
										</tr>
										<%
									});
								}
								else{ %>
									<tr><td colspan="7" class="_pea-text-center">No Items!</td></tr>
								<%} %>
						</tbody>
						<tfoot style="">
							<tr>
								<th colspan="4" class="_pea-text-left ">
									Page
									<a href="">&laquo;</a> 
									<input type="text" name="pagenum" class="_pea-text-center" style="width:2em;" value="<%- request.query.pagenum %>"/> of <%- itempages %> 
									<a href="">&raquo;</a>
								</th>
								<th colspan="3" class="_pea-text-right ">
									<span ><input type="text" name="itemsperpage" class="_pea-text-center"  style="width:2em;" value="<%- request.query.limit %>"/> per page</span> | 
									<span><%- itemscount %> items</span>
								</th>
							</tr>
						</tfoot>
						<!-- <tfoot>
							<tr class="_pea-text-left">
								<th>Title</th>
								<th>Author</th>
								<th>Categories</th>
								<th>Tags</th>
								<th>Type</th>
								<th>Date</th>
								<th></th>
							</tr>
						</tfoot> -->
					</table>
				</div>
			</div>
		</div>
	</div>
</form>
<script type="text/javascript">
	window.backToItemLanding = function () {
		window.location = '/p-admin/items';
	};
</script>
<% include ../../shared/footer %>
